<script type="text/x-red" data-template-name="wotkit in">
    <div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>WoTKit Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
    <div class="form-row">
        <label for="node-input-timeout"><i class="icon-tag"></i>Poll Interval</label>
        <input type="text" id="node-input-timeout" placeholder="Interval in milliseconds">
    </div>
    <div id="node-input-tip" class="form-tips">The url will be relative to <code><span id="node-input-path"></span></code>.</div>
</script>

<script type="text/x-red" data-help-name="wotkit in">
    <p>Provides an input node for WoTKit, allowing the creation of simple web services.</p>
    <p>The resulting message has the following properties:
        <ul>
            <li>msg.req : <a href="http://expressjs.com/api.html#req">http request</a></li>
            <li>msg.res : <a href="http://expressjs.com/api.html#res">http response</a></li>
        </ul>
    </p>
    <p>For POST/PUT requests, the body is available under <code>msg.req.body</code>. This
       uses the <a href="http://expressjs.com/api.html#bodyParser">Express bodyParser middleware</a> to parse the content to a JSON object.
    </p>
    <p>
       By default, this expects the body of the request to be url encoded:
       <pre>foo=bar&amp;this=that</pre>
    </p>
    <p>
       To send JSON encoded data to the node, the content-type header of the request must be set to
       <code>application/json</code>.
    </p>
    <p>
       <b>Note: </b>This node does not send any response to the http request. This should be done with
       a subsequent HTTP Response node, or Function node.
       In the case of a Function node, the <a href="http://expressjs.com/api.html#res">Express response documentation</a>
       describes how this should be done. For example:
       <pre>msg.res.send(200, 'Thanks for the request ');<br/>return msg;</pre>
    </p>

</script>

<script type="text/x-red" data-template-name="wotkit out">
    <div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>WoTKit Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
    <div class="form-tips">The messages sent to this node <b>must</b> originate from an <i>http input</i> node</div>
</script>

<script type="text/x-red" data-help-name="wotkit out">
    <p>Sends responses back to WoTKit received from an HTTP Input node.</p>
    <p>The response can be customised using the following message properties:</p>
    <ul>
        <li><code>payload</code> is sent as the body of the response</li>
        <li><code>statusCode</code>, if set, is used as the response status code (default: 200)</li>
        <li><code>headers</code>, if set, should be an object containing field/value
        pairs to be added as response headers.</li>
    </ul>
</script>

<script type="text/x-red" data-template-name="wotkit-credentials">
    <div class="form-row node-input-broker">
        <label for="node-config-input-nickname"><i class="fa fa-globe"></i> Config Name</label>
        <input class="input-append-left" type="text" id="node-config-input-nickname" placeholder="Nickname" >
    </div>
    <div class="form-row">
        <label for="node-config-input-user"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-user">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-password">
    </div>
</script>


<script type="text/javascript">
    RED.nodes.registerType('wotkit in',{
        category: 'input',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            sensor: {value:"",required:true},
            timeout: {value:"5000",required:true},
            login: {value:"", type:"wotkit-credentials"},
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.url) {
                var root = RED.settings.httpNodeRoot;
                if (root.slice(-1) != "/") {
                    root = root+"/";
                }
                if (this.url.charAt(0) == "/") {
                    root += this.url.slice(1);
                } else {
                    root += this.url;
                }
                return "["+this.method+"] "+root;
            } else {
                return "WotKit In";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root == "") {
                $("#node-input-tip").hide();
            } else {
                $("#node-input-path").html(root);
                $("#node-input-tip").show();
            }
            //document.getElementById("node-config-wsdocpath").innerHTML=
        }

    });

    RED.nodes.registerType('wotkit out',{
        category: 'output',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            sensor: {value:"",required:true},
            timeout: {value:"5000",required:true},
            login: {value:"", type:"wotkit-credentials"},
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "white-globe.png",
        label: function() {
            return this.name||"WotKit Out";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
        },
    });
    
    RED.nodes.registerType('wotkit-credentials',{
        category: 'config',
        defaults: {
            nickname: {value:"Default"}
        },
        credentials: {
            user: {type: "text"},
            password: {type:"password"}
        },
            
        label: function() {
            return this.nickname;
        }
    });
</script>
