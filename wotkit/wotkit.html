<!-- Node for WoTKit Sensor Input -->
<script type="text/x-red" data-template-name="wotkit data-in">
    <div class="form-row">
        <label for="node-input-login"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
    <div id="poll-details" class="form-row">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> Poll Every</label>
        <input type="text" id="node-input-timeout" placeholder="Time" style="direction:rtl; width:50px !important">
        <select id="node-input-timeoutUnits" style="width:200px !important">
          <option value="seconds">Seconds</option>
          <option value="minutes">Minutes</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-help-name="wotkit data-in">

    <p>Provides input from a WoTKit sensor allowing <em>new</em> data sent to a sensor to be used in your flows.</p>
    <p>This node does not currently retrieve data from the past, or previous sensor readings, only new data sent to a WoTKit sensor after this node is deployed.</p>
    
    <p>The <code>message.payload</code> contains a map of sensor field names to sensor values.
    </p>
    <p>
       To use this node, the WoTKit URL (default is the <a href="http://wotkit.sensetecnic.com">WoTKit sandbox</a>) and login credentials must be provided.  Credentials can be either your WoTKit user name and password, or a key id and password associated with your account.
    </p>
    <p>
       The sensor name should be in the form <code>{username}.{sensorname}</code> or you can use the numeric sensor id.
    </p>
    <p>The poll interval specifies how often this node calls the WoTKit to retrieve new sensor data.  </p>
    <p><strong>Note:</strong>  the first request will occur after the intial poll interval has elapsed, starting with data sent to the sensor after the node was deployed.
    </p>

</script>

<!-- Node for WoTKit Sensor Output -->

<script type="text/x-red" data-template-name="wotkit data-out">
    <div class="form-row">
        <label for="node-input-login"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
</script>

<script type="text/x-red" data-help-name="wotkit data-out">
    <p>Provides output to a registered WoTKit sensor.</p>

    <p>The <code>message.payload</code> must contain an Object of key-value pairs matching the sensor fields. For example a sensor with the default fields expects:</p>
    <pre>msg.payload = {
	value:1028,
	lat:123.60,
	lng:49.23,
	message:"Memory Update"
}</pre>

    <p>If receiving a number from another node, for example <code>message.payload = 123456</code> the sensor's <code>value</code> field will be updated using the following object:</p>
    <pre>msg.payload = { value:  123456}</pre>

    <p>If receiving a string from another node, for example <code>message.payload = "Hello World"</code> the sensor's <code>message</code> field will be updated using the following object:</p>
    <pre>msg.payload = { message:  "Hello World"}</pre>

    <p>To use this node, WoTKit login credentials must be provided.  This can be either the user name and password, or a key id and password associated with the account.</p>
    <p>
       The WotKit Sensor Name should be in the form of <code>{username}.{sensorname}</code> or using the numeric sensor id.
    </p>
</script>



<!-- Node for WoTKit Control Output -->

<script type="text/x-red" data-template-name="wotkit control-out">
    <div class="form-row">
        <label for="node-input-login"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
</script>

<script type="text/x-red" data-help-name="wotkit control-out">
    <p>Provides control output to a registered WoTKit sensor.</p>

    <p>The <code>message.payload</code> must contain an Object of key-value pair for each message. For example, to send a control <code>button: on</code> message:</p>
    <pre>msg.payload = {
	"button":"on"
}</pre>

    <p>If receiving a number from another node, for example <code>message.payload = 123456</code> the following message will be sent:</p>
    <pre>msg.payload = { "slider":  "123456"}</pre>

    <p>If receiving a string from another node, for example <code>message.payload = "Hello World"</code> the following message will be sent:</p>
    <pre>msg.payload = { "message":  "Hello World"}</pre>

    <p>To use this node, WoTKit login credentials must be provided.  This can be either the user name and password, or a key id and password associated with the account.</p>
    <p>
       The WotKit Sensor Name should be in the form of <code>{username}.{sensorname}</code> or using the numeric sensor id.
    </p>


</script>


<!-- TODO: Node for WoTKit Control Input -->

<script type="text/x-red" data-template-name="wotkit control-in">
    <div class="form-row">
        <label for="node-input-login"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-login">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sensor"><i class="icon-tag"></i>Sensor</label>
        <input type="text" id="node-input-sensor" placeholder="Sensor Name">
    </div>
</script>

<script type="text/x-red" data-help-name="wotkit control-in">

    <p>Provides input from a WoTKit sensor control.</p>
    
    <p>The <code>message.payload</code> contains an object containing messages sent</p>
    <p>
       To use this node, the WoTKit URL (default is the <a href="http://wotkit.sensetecnic.com">WoTKit sandbox</a>) and login credentials must be provided.  Credentials can be either your WoTKit user name and password, or a key id and password associated with your account.
    </p>
    <p>
       The sensor name should be in the form <code>{username}.{sensorname}</code> or you can use the numeric sensor id.
    </p>
    <p><strong>Note:</strong>  the first request will occur after the intial poll interval has elapsed, starting with data sent to the sensor after the node was deployed.
    </p>

</script>


<!-- Node for WoTKit Credentials -->

<script type="text/x-red" data-template-name="wotkit-credentials">
    <div class="form-row node-input-broker">
        <label for="node-config-input-nickname"><i class="fa fa-globe"></i> Config Name</label>
        <input class="input-append-left" type="text" id="node-config-input-nickname" placeholder="Nickname" >
    </div>
    <div class="form-row">
        <label for="node-config-input-url"><i class="fa fa-user"></i> WoTKit url</label>
        <input type="text" id="node-config-input-url" placeholder="http://wotkit.sensetecnic.com">
    </div>
    <div class="form-row">
        <label for="node-config-input-user"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-user">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-password">
    </div>
</script>


<script type="text/javascript">

    /*
     * Node for WoTKit Sensor Input
     */

    RED.nodes.registerType('wotkit data-in',{
        category: 'input',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            timeout: {value:"5", required:true, validate:RED.validators.number()},
            timeoutUnits: {value:"seconds",required:true},
            sensor: {required:true},
            login: {type:"wotkit-credentials"},
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.sensor) {
                return this.sensor;
            } else {
                return "wotkit data";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root == "") {
                $("#node-input-tip").hide();
            } else {
                $("#node-input-path").html(root);
                $("#node-input-tip").show();
            }
            $( "#node-input-timeout" ).spinner({min:1,max:60});
            if (!this.timeoutUnits) {
                $("#node-input-timeoutUnits option").filter(function() {
                  return $(this).val() == 'seconds';
                }).attr('selected', true);
            }

        }

    });


    /*
     * Node for WoTKit Sensor Output
     */

    RED.nodes.registerType('wotkit data-out',{
        category: 'output',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            sensor: {value:"",required:true},
            login: {value:"", type:"wotkit-credentials"},
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.sensor) {
                return this.sensor;
            } else {
                return "wotkit data";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
        },
    });


    /*
     * Node for WoTKit Sensor Control Output
     */

    RED.nodes.registerType('wotkit control-out',{
        category: 'output',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            sensor: {value:"",required:true},
            login: {value:"", type:"wotkit-credentials"},
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.sensor) {
                return this.sensor;
            } else {
                return "wotkit control";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
        },
    });


    /*
     * Node for WoTKit Sensor Control Input
     */

    RED.nodes.registerType('wotkit control-in',{
        category: 'input',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            timeout: {value:"10", validate:RED.validators.number()},
            timeoutUnits: {value:"seconds"},
            sensor: {required:true},
            login: {type:"wotkit-credentials"},
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.sensor) {
                return this.sensor;
            } else {
                return "wotkit control";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root == "") {
                $("#node-input-tip").hide();
            } else {
                $("#node-input-path").html(root);
                $("#node-input-tip").show();
            }
            $( "#node-input-timeout" ).spinner({min:1,max:60});
            if (!this.timeoutUnits) {
                $("#node-input-timeoutUnits option").filter(function() {
                  return $(this).val() == 'seconds';
                }).attr('selected', true);
            }

        }

    });













    

    /*
     * Node for WoTKit Sensor Credentials
     */

    RED.nodes.registerType('wotkit-credentials',{
        category: 'config',
        defaults: {
            nickname: {value:"Default", required:true},
            url: {value:"http://wotkit.sensetecnic.com", required:true}
        },
        credentials: {
            user: {type: "text", required:true},
            password: {type:"password", required:true},
        },
        label: function() {
            return this.nickname;
        }
    });
</script>
